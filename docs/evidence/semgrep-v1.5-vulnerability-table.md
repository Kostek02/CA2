# Semgrep v1.5 Vulnerability Table

**Generated:** v1.5-semgrep  
**Tool:** Semgrep with OWASP Top 10 rule sets  
**Total Findings:** 13 security issues

---

## Summary by OWASP Category

### Semgrep Findings (Detected)
| OWASP 2025 Category | OWASP 2021 Category | Count | Severity | CWE |
|---------------------|-------------------|-------|----------|-----|
| **A05 - Injection** | A03:2021 - Injection | 13 | High | CWE-89 (SQL Injection) |

**Note:** Semgrep detected 13 SQL injection vulnerabilities resulting from string concatenation in SQL queries.

### Additional Vulnerabilities (Not Detected by Semgrep)
| OWASP 2025 Category | Vulnerability Type | Count | Severity | CWE | Evidence |
|---------------------|-------------------|-------|----------|-----|----------|
| **A01 - Broken Access Control** | IDOR (Insecure Direct Object Reference) | Multiple | High | CWE-639 | v0.9.4 testing - No ownership checks on notes |
| **A01 - Broken Access Control** | Unauthorized Admin Access | 1 route | High | CWE-284 | v0.9.4 testing - `/admin` accessible without auth |
| **A04 - Cryptographic Failures** | Plaintext Password Storage | All users | High | CWE-256 | v0.9.4 testing - Passwords stored in plaintext |
| **A07 - Authentication Failures** | Weak Authentication | Multiple | High | CWE-287 | v0.9.4 testing - No password hashing |
| **A05 - Injection** | Cross-Site Scripting (XSS) | Potential | Medium | CWE-79 | v0.9.4 testing - No output encoding |
| **A05 - Injection** | CSRF (Cross-Site Request Forgery) | All forms | Medium | CWE-352 | v0.9.4 testing - No CSRF tokens |

**Total Vulnerabilities in Codebase:** 19+ (13 detected by Semgrep + 6+ additional)

---

## Detailed Vulnerability Table

| # | OWASP Category | Finding | File | Line(s) | Severity | CWE | Rule ID |
|---|----------------|---------|------|---------|----------|-----|---------|
| 1 | **A05:2025 - Injection**<br>A03:2021 - Injection | SQL Injection - Tainted SQL String | `app/auth/routes.py` | 51 | ERROR | CWE-89 | `python.flask.security.injection.tainted-sql-string` |
| 2 | **A05:2025 - Injection**<br>A03:2021 - Injection | SQL Injection - Tainted SQL String | `app/auth/routes.py` | 64 | ERROR | CWE-89 | `python.flask.security.injection.tainted-sql-string` |
| 3 | **A05:2025 - Injection**<br>A03:2021 - Injection | SQL Injection - Tainted SQL String | `app/auth/routes.py` | 104 | ERROR | CWE-89 | `python.flask.security.injection.tainted-sql-string` |
| 4 | **A05:2025 - Injection**<br>A03:2021 - Injection | SQL Injection - DB Cursor Execute | `app/notes/routes.py` | 59-83 | WARNING | CWE-89 | `python.django.security.injection.sql.sql-injection-using-db-cursor-execute` |
| 5 | **A05:2025 - Injection**<br>A03:2021 - Injection | SQL Injection - Tainted SQL String | `app/notes/routes.py` | 78 | ERROR | CWE-89 | `python.flask.security.injection.tainted-sql-string` |
| 6 | **A05:2025 - Injection**<br>A03:2021 - Injection | SQL Injection - Tainted SQL String | `app/notes/routes.py` | 81 | ERROR | CWE-89 | `python.flask.security.injection.tainted-sql-string` |
| 7 | **A05:2025 - Injection**<br>A03:2021 - Injection | SQL Injection - Tainted SQL String | `app/notes/routes.py` | 110 | ERROR | CWE-89 | `python.flask.security.injection.tainted-sql-string` |
| 8 | **A05:2025 - Injection**<br>A03:2021 - Injection | SQL Injection - Tainted SQL String | `app/notes/routes.py` | 146 | ERROR | CWE-89 | `python.flask.security.injection.tainted-sql-string` |
| 9 | **A05:2025 - Injection**<br>A03:2021 - Injection | SQL Injection - Tainted SQL String | `app/notes/routes.py` | 157 | ERROR | CWE-89 | `python.flask.security.injection.tainted-sql-string` |
| 10 | **A05:2025 - Injection**<br>A03:2021 - Injection | SQL Injection - Tainted SQL String | `app/notes/routes.py` | 166 | ERROR | CWE-89 | `python.flask.security.injection.tainted-sql-string` |
| 11 | **A05:2025 - Injection**<br>A03:2021 - Injection | SQL Injection - Tainted SQL String | `app/notes/routes.py` | 195 | ERROR | CWE-89 | `python.flask.security.injection.tainted-sql-string` |
| 12 | **A05:2025 - Injection**<br>A03:2021 - Injection | SQL Injection - Tainted SQL String | `app/notes/routes.py` | 205 | ERROR | CWE-89 | `python.flask.security.injection.tainted-sql-string` |
| 13 | **A05:2025 - Injection**<br>A03:2021 - Injection | SQL Injection - DB Cursor Execute | `app/notes/routes.py` | 60-83 | WARNING | CWE-89 | `python.django.security.injection.sql.sql-injection-using-db-cursor-execute` |

---

## Findings by File

### app/auth/routes.py (3 findings)
- **Line 51:** Username check query - SQL injection via string concatenation
- **Line 64:** User registration INSERT - SQL injection via string concatenation  
- **Line 104:** Login query - SQL injection via string concatenation

### app/notes/routes.py (10 findings)
- **Lines 59-83:** User input passed to execute() - SQL injection risk
- **Line 78:** INSERT note with user_id - SQL injection via string concatenation
- **Line 81:** INSERT note without user_id - SQL injection via string concatenation
- **Line 110:** SELECT note by ID - SQL injection via string concatenation
- **Line 146:** SELECT note by ID (edit) - SQL injection via string concatenation
- **Line 157:** UPDATE note - SQL injection via string concatenation
- **Line 166:** SELECT note by ID (delete) - SQL injection via string concatenation
- **Line 195:** SELECT note by ID (view) - SQL injection via string concatenation
- **Line 205:** DELETE note - SQL injection via string concatenation
- **Lines 60-83:** User input passed to execute() - SQL injection risk (duplicate detection)

---

## Severity Breakdown

| Severity | Count | Percentage |
|----------|-------|------------|
| **ERROR** | 11 | 84.6% |
| **WARNING** | 2 | 15.4% |
| **Total** | 13 | 100% |

---

## OWASP Top 10 2025 Mapping

### A05:2025 - Injection (CWE-89: SQL Injection)
**All 13 Semgrep findings** are classified under OWASP A05:2025 - Injection.

**Mapping to PRD Security Requirements:**
- **SR4 - Input Sanitisation:** Missing parameterized queries
- **SR2 - CSRF Protection:** Not directly related, but part of injection defense

**Description:** User input is directly concatenated into SQL queries without parameterization, allowing attackers to inject malicious SQL code.

**Impact:**
- Unauthorized database access
- Data theft or modification
- Authentication bypass
- Privilege escalation

**Affected Operations:**
- User registration
- User authentication
- Note creation
- Note retrieval
- Note updates
- Note deletion

### Additional OWASP 2025 Categories Present (Not Detected by Semgrep)

#### A01:2025 - Broken Access Control (CWE-639, CWE-284)
- **IDOR:** No ownership checks on notes (view/edit/delete any note)
- **Unauthorized Admin Access:** `/admin` route accessible without authentication
- **Mapping to PRD:** SR5 - RBAC (missing)

#### A04:2025 - Cryptographic Failures (CWE-256)
- **Plaintext Password Storage:** All passwords stored in cleartext
- **Mapping to PRD:** SR1 - Password Hashing (missing)

#### A07:2025 - Authentication Failures (CWE-287)
- **Weak Authentication:** No password hashing, weak session management
- **Mapping to PRD:** SR1 - Password Hashing, SR3 - Session Security (missing)

#### A05:2025 - Injection (Additional)
- **XSS:** No output encoding in templates (CWE-79)
- **CSRF:** No CSRF tokens in forms (CWE-352)
- **Mapping to PRD:** SR4 - Input Sanitisation, SR2 - CSRF Protection (missing)

---

## Comparison with Bandit Findings

| Tool | SQL Injection Findings | Files Affected |
|------|------------------------|----------------|
| **Bandit** | 11 (B608) | `app/auth/routes.py` (3), `app/notes/routes.py` (8) |
| **Semgrep** | 13 (various rules) | `app/auth/routes.py` (3), `app/notes/routes.py` (10) |

**Note:** Semgrep detected 2 additional findings due to detecting user input flow to `execute()` calls, providing broader coverage than Bandit's string-based detection.

---

## Remediation Recommendations

All findings require the same remediation approach:

1. **Use Parameterized Queries:** Replace string concatenation with parameterized queries
   ```python
   # INSECURE (current)
   query = f"SELECT * FROM users WHERE username = '{username}'"
   
   # SECURE (recommended)
   query = "SELECT * FROM users WHERE username = ?"
   db.execute(query, (username,))
   ```

2. **Use ORM:** Consider migrating to SQLAlchemy ORM for automatic parameterization

3. **Input Validation:** Add input validation and sanitization (though parameterization is primary defense)

**Planned Fix:** v2.1.1-csrf-forms will introduce parameterized queries and input validation.

---

## Baseline for v2.x Comparison

This table serves as the **insecure baseline** for comparison with the secure v2.x version. After security hardening, Semgrep should report **0 SQL injection findings**.

---

**Report Generated:** v1.5-semgrep  
**Next Phase:** v2.0 - Security Hardening

